<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RPG Dice Roller</title>
  <style>
    body { font-family: system-ui; background: #0f172a; color: #e5e7eb; margin:0; padding:0.5rem; }
    header { display:flex; flex-wrap:wrap; justify-content:space-between; align-items:center; margin-bottom:0.5rem; }
    .btn { background:#2563eb; color:white; border:none; padding:10px 14px; border-radius:6px; cursor:pointer; font-size:16px; margin:2px; flex:1; }
    .btn.small { font-size:12px; padding:6px 8px; flex:unset; }
    .row { display:flex; flex-wrap:wrap; margin-bottom:8px; gap:4px; }
    .row label { margin-right:4px; }
    .count-control { display:flex; align-items:center; }
    .count-control button { font-size:20px; padding:8px 12px; margin:0 4px; }
    .count-control input { font-size:18px; width:60px; text-align:center; }
    .card { background:#1e293b; padding:10px; border-radius:6px; margin-top:0.5rem; }
    .history-item { border-bottom:1px solid #334155; padding:4px 0; font-size:14px; }
    .kept { color:#22c55e; font-weight:bold; }
    input[type=number], input[type=text] { padding:6px; border-radius:4px; border:none; font-size:16px; }
    @media (max-width:600px){
      .btn { font-size:14px; padding:8px 10px; }
      .count-control input { width:50px; }
      header { flex-direction:column; align-items:flex-start; gap:4px; }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <span style="font-size:18px;">ðŸŽ² RPG Dice Roller</span>
    <div>
      <button id="shareBtn" class="btn small">Share</button>
      <button id="rollBtn" class="btn">Roll</button>
    </div>
  </header>  <!-- Dice selection row -->  <div class="row" id="diceRow"></div>  <!-- Count row -->  <div class="row">
    <label>Count:</label>
    <div class="count-control">
      <button id="decrCount" class="btn">â€“</button>
      <input id="count" type="number" min="1" max="20" value="1" />
      <button id="incrCount" class="btn">+</button>
    </div>
  </div>  <!-- Special settings row -->  <div class="row">
    <button id="advBtn" class="btn">Advantage</button>
    <button id="disBtn" class="btn">Disadvantage</button>
    <label>Modifier:</label>
    <input id="modifier" type="number" value="0" style="width:70px;" />
    <label>Success â‰¥</label>
    <input id="successTarget" type="number" min="0" max="100" value="0" style="width:70px;" />
    <label>Count Max</label>
    <input id="countMax" type="checkbox" />
  </div>  <section class="card" id="currentCard" hidden>
    <h3>Result</h3>
    <div id="attempts"></div>
    <div id="final"></div>
  </section>  <section class="card">
    <h3>History <button id="clearHistory" class="btn small">Clear</button></h3>
    <div id="history"></div>
  </section>
</div><script>
const diceFaces=[2,3,4,6,8,10,12,20,100];
const diceRow=document.getElementById('diceRow');
diceFaces.forEach(f=>{
  let b=document.createElement('button');
  b.textContent='d'+f;
  b.className='btn';
  b.onclick=()=>{state.faces=f;};
  diceRow.appendChild(b);
});

const state={faces:6,count:1,modifier:0,successTarget:0,countMax:false,mode:'normal',history:[]};

function randInt(max){return Math.floor(Math.random()*max)+1;}
function basicRoll(faces,count){let rolls=[];for(let i=0;i<count;i++)rolls.push(randInt(faces));return rolls;}

function performRoll(){
  state.count=parseInt(count.value);
  state.modifier=parseInt(modifier.value);
  state.successTarget=parseInt(successTarget.value);
  state.countMax=document.getElementById('countMax').checked;

  function oneRoll(){
    let rolls=basicRoll(state.faces,state.count);
    let sum=rolls.reduce((a,b)=>a+b,0);
    let info="";
    if(state.successTarget>0){ sum=rolls.filter(r=>r>=state.successTarget).length; info=`Successes (â‰¥${state.successTarget})`; }
    if(state.countMax){
      const cnt=rolls.filter(r=>r===state.faces).length;
      info=`Max rolls (${state.faces}) counted: ${cnt}`;
      return {rolls,sum:sum,info,extra:cnt};
    }
    return {rolls,sum,info};
  }

  let attempts=[];
  if(state.mode==='normal'){
    const a=oneRoll();
    attempts=[{...a,kept:true}];
  } else {
    const a=oneRoll();
    const b=oneRoll();
    const keep=(state.mode==='adv')?(a.sum>=b.sum):(a.sum<=b.sum);
    attempts=[{...a,kept:keep},{...b,kept:!keep}];
  }

  let kept=attempts.find(x=>x.kept);
  let final=kept.sum+state.modifier;
  renderCurrent(attempts,final);
  state.history.unshift({t:Date.now(),attempts,final});
  renderHistory();
}

function renderCurrent(attempts,final){
  currentCard.hidden=false;
  const attemptsEl=document.getElementById('attempts');
  const finalDiv=document.getElementById('final');
  attemptsEl.innerHTML='';
  attempts.forEach(a=>{
    let div=document.createElement('div');
    div.className='history-item';
    let info=a.info?` <em>${a.info}</em>`:"";
    div.innerHTML=`<span>[${a.rolls.join(', ')}]</span> â‡’ <strong>${a.sum}</strong>${a.kept?' <span class="kept">(kept)</span>':''}${info}`;
    attemptsEl.appendChild(div);
  });
  finalDiv.textContent='Total: '+final;
}

function renderHistory(){
  const historyEl=document.getElementById('history');
  historyEl.innerHTML='';
  state.history.forEach(h=>{
    let div=document.createElement('div');
    div.className='history-item';
    const time=new Date(h.t).toLocaleTimeString();
    const kept=h.attempts.find(a=>a.kept);
    let info=kept.info?` <em>${kept.info}</em>`:"";
    div.innerHTML=`${time} â‡’ [${kept.rolls.join(', ')}] = <strong>${h.final}</strong>${info}`;
    historyEl.appendChild(div);
  });
}

rollBtn.onclick=performRoll;
advBtn.onclick=()=>{state.mode='adv'; count.value=1;};
disBtn.onclick=()=>{state.mode='dis'; count.value=1;};
clearHistory.onclick=()=>{if(confirm('Clear history?')){state.history=[];renderHistory();}};
shareBtn.onclick=()=>{const url=new URL(location);url.searchParams.set('dice',state.faces);url.searchParams.set('count',state.count);navigator.clipboard.writeText(url).then(()=>alert('Link copied!'));};

decrCount.onclick=()=>{let v=parseInt(count.value)||1;if(v>1){count.value=v-1;}};
incrCount.onclick=()=>{let v=parseInt(count.value)||1;if(v<20){count.value=v+1;}};
</script></body>
</html>
